<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Documentation - <%= @config.app_name %></title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <%= render partial: 'rails_doc_generator/docs/styles' %>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="header-content">
        <div>
          <h1><%= @config.app_name %></h1>
          <p class="subtitle">API Documentation</p>
        </div>
        <div class="header-badge">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12,6 12,12 16,14"/>
          </svg>
          Auto-generated
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value"><%= (@routes || {}).size %></div>
        <div class="stat-label">Controllers</div>
      </div>
      <div class="stat-card">
        <div class="stat-value"><%= (@routes || {}).values.sum { |d| d[:routes]&.size || 0 } %></div>
        <div class="stat-label">Routes</div>
      </div>
      <div class="stat-card">
        <div class="stat-value"><%= (@models || {}).size %></div>
        <div class="stat-label">Models</div>
      </div>
    </div>

    <div class="search-wrapper">
      <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
      </svg>
      <input type="text" id="search-input" class="search-input" placeholder="Search controllers and models...">
    </div>

    <div class="nav">
      <%= link_to rails_doc_generator.routes_path do %>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 10h-4V6"/>
          <path d="M14 10 21 3"/>
          <path d="M21 14v5a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5"/>
        </svg>
        View All Routes
      <% end %>
    </div>

    <section class="section" id="controllers-section">
      <h2 class="section-header">
        Controllers
        <span class="section-count"><%= (@routes || {}).size %></span>
      </h2>
      <% if (@routes || {}).any? %>
        <div class="grid">
          <% (@routes || {}).each do |controller, data| %>
            <div class="card" data-searchable="<%= controller.downcase %>">
              <div class="card-header">
                <h3 class="card-title" title="<%= controller.camelize %>Controller"><%= controller.camelize %></h3>
                <span class="badge badge-count"><%= data[:routes].size %> routes</span>
              </div>
              <div class="card-meta">
                <div class="card-meta-item">
                  <span class="card-meta-label">Base Path</span>
                  <code class="card-meta-value"><%= data[:base_path] || '/' %></code>
                </div>
              </div>
              <div class="card-stats">
                <div class="card-stat">
                  <span class="card-stat-value"><%= data[:actions].size %></span>
                  <span class="card-stat-label">Actions</span>
                </div>
                <div class="card-stat">
                  <span class="card-stat-value"><%= data[:routes].size %></span>
                  <span class="card-stat-label">Endpoints</span>
                </div>
              </div>
              <div class="card-footer">
                <span class="card-actions"><%= data[:actions][0..2].join(', ') %><%= data[:actions].size > 3 ? '...' : '' %></span>
                <%= link_to rails_doc_generator.controller_doc_path(name: controller), class: "card-link" do %>
                  View
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14"/>
                    <path d="m12 5 7 7-7 7"/>
                  </svg>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="empty-state">
          <div class="empty-state-icon">üìÇ</div>
          <p>No controllers found</p>
        </div>
      <% end %>
    </section>

    <section class="section" id="models-section">
      <h2 class="section-header">
        Models
        <span class="section-count"><%= (@models || {}).size %></span>
      </h2>
      <% if (@models || {}).any? %>
        <div class="grid">
          <% (@models || {}).each do |name, model| %>
            <div class="card" data-searchable="<%= name.downcase %>">
              <div class="card-header">
                <h3 class="card-title" title="<%= name %>"><%= name %></h3>
                <span class="badge badge-count"><%= model.columns.size %> cols</span>
              </div>
              <div class="card-meta">
                <div class="card-meta-item">
                  <span class="card-meta-label">Table</span>
                  <code class="card-meta-value"><%= model.table_name || 'N/A' %></code>
                </div>
              </div>
              <div class="card-stats">
                <div class="card-stat">
                  <span class="card-stat-value"><%= model.columns.size %></span>
                  <span class="card-stat-label">Columns</span>
                </div>
                <div class="card-stat">
                  <span class="card-stat-value"><%= model.associations.size %></span>
                  <span class="card-stat-label">Relations</span>
                </div>
                <% if model.validations.any? %>
                <div class="card-stat">
                  <span class="card-stat-value"><%= model.validations.size %></span>
                  <span class="card-stat-label">Validations</span>
                </div>
                <% end %>
              </div>
              <div class="card-footer">
                <span class="card-actions">pk: <%= model.primary_key || 'id' %></span>
                <%= link_to rails_doc_generator.model_doc_path(name: name), class: "card-link" do %>
                  View
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14"/>
                    <path d="m12 5 7 7-7 7"/>
                  </svg>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="empty-state">
          <div class="empty-state-icon">üóÉÔ∏è</div>
          <p>No models found</p>
        </div>
      <% end %>
    </section>
  </main>

  <footer class="footer">
    Generated by <a href="https://github.com/your-repo/rails_doc_generator" target="_blank">RailsDocGenerator</a>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.getElementById('search-input');
      const cards = document.querySelectorAll('.card[data-searchable]');
      const sections = document.querySelectorAll('.section');
      
      searchInput.addEventListener('input', function() {
        const query = this.value.toLowerCase().trim();
        
        cards.forEach(function(card) {
          const searchable = card.getAttribute('data-searchable');
          if (query === '' || searchable.includes(query)) {
            card.style.display = '';
            card.style.opacity = '1';
          } else {
            card.style.display = 'none';
            card.style.opacity = '0';
          }
        });
        
        // Update section visibility
        sections.forEach(function(section) {
          const grid = section.querySelector('.grid');
          const emptyState = section.querySelector('.empty-state');
          if (grid) {
            const visibleCards = grid.querySelectorAll('.card[data-searchable]:not([style*="display: none"])');
            const hasVisible = visibleCards.length > 0;
            section.style.display = hasVisible || query === '' ? '' : 'none';
          }
        });
      });
    });
  </script>
</body>
</html>
